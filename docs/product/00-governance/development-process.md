# 研发流程（Stages & Rules）

本文件定义 Wallet RPC 的研发阶段与各阶段准则（含准入/退出条件）。
目的：降低沟通成本，确保“产品目标、文档、代码、测试”持续一致，并始终满足 **RPC-only、后台 0 依赖、零遥测** 的不可变原则。

## 0. 总原则（跨阶段生效）
- **P0 不可变原则**：业务数据请求仅可访问去中心化节点 RPC（详见 `immutable-principle-rpc-only.md`）。
- **文档优先**：需求/规则变更必须先更新文档，再进入实现。
- **可验收**：每项需求必须具备可验证的验收标准。
- **可追踪**：建议为需求分配 ID，并在实现/测试中可追溯（见 `change-process.md`）。

## 1. 阶段划分
建议将一次功能或版本迭代按以下阶段推进：
1. 产品定义阶段（Product Definition）
2. 设计与约束检查阶段（Design & Constraints）
3. 实现阶段（Implementation）
4. 验证阶段（Verification）
5. 产品验收阶段（Product Acceptance）
6. 发布阶段（Release）

说明：阶段不强制严格串行，但进入“产品验收阶段”前必须完成所有前置条件。

## 2. 各阶段准则

### 2.1 产品定义阶段（Product Definition）
目标：明确要解决的问题与边界。

准则：
- 明确用户故事（角色/目标/收益）。
- 给出验收标准（可验证、可复现）。
- 识别是否触碰 P0 原则（RPC-only）。

退出条件：
- `02-requirements/` 与 `03-user-stories/` 已补齐条目与验收标准。

### 2.2 设计与约束检查阶段（Design & Constraints）
目标：把“怎么做”约束清楚，避免实现跑偏。

准则：
- 架构上不引入中心化后端依赖。
- 明确数据生命周期：哪些数据可缓存、何时刷新、何时禁止心跳式刷新。
- 明确错误码/i18n/体验策略（例如错误去重、冷却、上限等）。

退出条件：
- `05-domain/`（术语、状态机、数据生命周期）如有变化已更新。

### 2.3 实现阶段（Implementation）
目标：按文档实现功能，保持可维护。

准则：
- 优先保证正确性与安全性，再优化性能。
- 不在实现阶段强制补齐“所有”测试（避免开发被测试拖慢）。
- 仍需保证基础回归：不允许引入明显的崩溃、阻断主流程的问题。

退出条件：
- 核心功能可手动跑通关键链路。

### 2.4 验证阶段（Verification）
目标：验证实现符合预期，提前发现回归。

准则：
- 补齐关键链路的自动化（可先覆盖 P0、资金相关、权限相关）。
- 验证 i18n 完整性与多端适配（PC/移动端）。

退出条件：
- 关键链路回归通过；主要风险点有测试覆盖或明确的人工验收步骤。

### 2.5 产品验收阶段（Product Acceptance）
目标：在发布前进行“终局对齐”和“补齐质量债”，确保交付可信。

准则（你制定的第一条准则，作为本阶段硬性要求）：
1. **代码与文档一致性对齐**
   - 对照 `docs/product/` 的目标、规则、需求与验收标准，审查代码实现是否一致。
   - 若不一致：必须二选一并记录
     - 更新文档以反映真实实现；或
     - 提出不一致点并修复代码使其符合文档。
2. **补齐自动化测试**
   - 补足单元测试与 UI 自动化测试（覆盖主要功能与关键风险点）。
3. **性能与体验问题修复**
   - 修复明显体验 bug（卡死、不可滚动、页面遮挡、跳转生硬等）。
   - 修复可观测的性能问题（无意义请求、重复刷新、渲染抖动、长列表卡顿等）。

退出条件（建议作为发布门槛）：
- 文档与代码已对齐（无未决不一致项）。
- 单元测试与 UI/E2E 关键链路测试通过。
- 主要性能/体验问题清零或明确降级与已知问题清单。

### 2.6 发布阶段（Release）
目标：生成版本说明与可复现交付。

准则：
- 更新 `docs/CHANGELOG.md`（面向用户/产品的关键变更）。
- 确认版本号与 Beta 标识一致（`config/app.ts`、`package.json` 等）。

退出条件：
- 版本说明完成，可发布。

